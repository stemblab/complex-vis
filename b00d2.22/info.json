{
  "id" : "b00d2.22",
  "moduleIdx" : 362,
  "baseId" : "b00d2.21",
  "name" : "Web Lab",
  "url" : "?id=b00d2.22",
  "valid" : true,
  "editor" : "lab_rev",
  "editorIp" : "58.28.155.63",
  "timestamp" : "2014-04-15 00:19:34",
  "isoTime" : "2014-04-15T00:19:34+12:00",
  "canAccessFolder" : true,
  "isSandbox" : false,
  "canCommit" : true,
  "share" : null,
  "isPublic" : true,
  "price" : null,
  "uses" : "b007c.5",
  "imports" : [
    {
      "id" : "b007c.5",
      "moduleIdx" : 221,
      "baseId" : "b007c.4",
      "name" : "Module Languages",
      "url" : "?id=b007c.5",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2013-08-22 20:20:34",
      "isoTime" : "2013-08-22T20:20:34+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : "gary",
      "isPublic" : true,
      "price" : null,
      "depth" : 1,
      "fromUses" : false,
      "importer" : "b00d2.22"
    },
    {
      "id" : "b000n.5",
      "moduleIdx" : 20,
      "baseId" : "b000n.4",
      "name" : "HTML\/JavaScript definition",
      "url" : "?id=b000n.5",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2012-08-19 12:17:24",
      "isoTime" : "2012-08-19T12:17:24+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : null,
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    },
    {
      "id" : "b006m.2",
      "moduleIdx" : 199,
      "baseId" : "b006m.1",
      "name" : "CoffeeScript definition",
      "url" : "?id=b006m.2",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2012-12-10 13:59:29",
      "isoTime" : "2012-12-10T13:59:29+13:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : null,
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    },
    {
      "id" : "b000d.15",
      "moduleIdx" : 12,
      "baseId" : "b000d.14",
      "name" : "Python definition",
      "url" : "?id=b000d.15",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2013-05-20 15:20:43",
      "isoTime" : "2013-05-20T15:20:43+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : "gary",
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    },
    {
      "id" : "b000g.10",
      "moduleIdx" : 14,
      "baseId" : "b000g.9",
      "name" : "Octave definition",
      "url" : "?id=b000g.10",
      "valid" : true,
      "editor" : "martin",
      "editorIp" : "58.28.155.63",
      "timestamp" : "2013-08-22 20:03:42",
      "isoTime" : "2013-08-22T20:03:42+12:00",
      "canAccessFolder" : true,
      "isSandbox" : false,
      "canCommit" : true,
      "share" : "gary",
      "isPublic" : true,
      "price" : null,
      "depth" : 2,
      "fromUses" : false,
      "importer" : "b007c.5"
    }
  ],
  "defs" : {
    "html" : {
      "src" : "b000n.5",
      "fileExt" : "html",
      "endToken" : "<!--puzlet_end-->",
      "endTokenExec" : "<!--puzlet_end-->",
      "passThru" : "true"
    },
    "javascript" : {
      "src" : "b000n.5",
      "fileExt" : "js",
      "endToken" : "\/\/!end",
      "endTokenExec" : "\/\/!end",
      "includeInHtmlHead" : "true"
    },
    "css" : {
      "src" : "b000n.5",
      "fileExt" : "css",
      "endToken" : "\/*!end*\/",
      "endTokenExec" : "\/*!end*\/",
      "includeInHtmlHead" : "true"
    },
    "coffee" : {
      "src" : "b006m.2",
      "fileExt" : "coffee",
      "endToken" : "#!end",
      "endTokenExec" : "#!end",
      "includeInHtmlHead" : "true"
    },
    "python" : {
      "src" : "b000d.15",
      "fileExt" : "py",
      "preamble" : "#!puzlet",
      "preambleExec" : "import puzlet",
      "postambleExec" : "puzlet.endScript()",
      "endToken" : "#!end",
      "endTokenExec" : "puzlet.end",
      "preProcessFileCommand" : "\nexport PYTHONPATH=..\/..\/..\/puzlet\/b000d.15; python ..\/..\/..\/puzlet\/b000d.15\/preprocessscript.py\n",
      "execFileCommand" : "\nexport PYTHONPATH=..\/..\/..\/puzlet\/b000d.15; python -W ignore::DeprecationWarning\n"
    },
    "octave" : {
      "src" : "b000g.10",
      "fileExt" : "m",
      "endToken" : "%!end",
      "endTokenExec" : "_end",
      "preProcessFileCommand" : "\nexport PYTHONPATH=..\/..\/..\/puzlet\/b000g.10; python ..\/..\/..\/puzlet\/b000g.10\/preprocessoctave.py\n",
      "execFileCommand" : "\noctave -H --no-line-editing -q\n"
    }
  },
  "exports" : null,
  "htmlResources" : "<script src='\/puzlet\/php\/source.php?pageId=b00d2.22&file=resources.js' type='text\/javascript'><\/script>\n<script src='\/puzlet\/php\/source.php?pageId=b00d2.22&file=extras.js' type='text\/javascript'><\/script>\n<link type='text\/css' rel='stylesheet' href='\/puzlet\/php\/source.php?pageId=b00d2.22&file=main.css'>\n<script src='\/puzlet\/php\/source.php?pageId=b00d2.22&file=main.js' type='text\/javascript'><\/script>\n<script src='\/puzlet\/php\/source.php?pageId=b00d2.22&file=result.js' type='text\/javascript'><\/script>\n<script src='\/puzlet\/php\/source.php?pageId=b00d2.22&file=main.js' type='text\/javascript'><\/script>\n",
  "usedModulePath" : [
    "..\/..\/..\/puzlet\/b007c.5",
    "..\/..\/..\/puzlet\/b000n.5",
    "..\/..\/..\/puzlet\/b006m.2",
    "..\/..\/..\/puzlet\/b000d.15",
    "..\/..\/..\/puzlet\/b000g.10"
  ],
  "codeNodes" : [
    {
      "id" : "resources",
      "lang" : "coffee",
      "filename" : "resources.coffee",
      "fileNoExt" : "resources",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "#!end",
      "idxInFile" : 0,
      "idxInPage" : 0,
      "codeBlockLength" : 6,
      "codeBlockStart" : 0,
      "show" : "0",
      "out" : "1",
      "code" : "$pz.resources = -> [\n# Handled directly in http.js.\n]"
    },
    {
      "id" : "window",
      "lang" : "html",
      "filename" : "window.html",
      "fileNoExt" : "window",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "<!--puzlet_end-->",
      "idxInFile" : 0,
      "idxInPage" : 1,
      "codeBlockLength" : 6,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "code" : "<div id=\"title\">\nWeb Lab\n<\/div>"
    },
    {
      "id" : "extras",
      "lang" : "coffee",
      "filename" : "extras.coffee",
      "fileNoExt" : "extras",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "#!end",
      "idxInFile" : 0,
      "idxInPage" : 2,
      "codeBlockLength" : 4,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "win" : "1",
      "code" : ""
    },
    {
      "id" : "css",
      "lang" : "css",
      "filename" : "main.css",
      "fileNoExt" : "main",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "\/*!end*\/",
      "idxInFile" : 0,
      "idxInPage" : 3,
      "codeBlockLength" : 4,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "win" : "1",
      "code" : ""
    },
    {
      "id" : "html",
      "lang" : "html",
      "filename" : "main.html",
      "fileNoExt" : "main",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "<!--puzlet_end-->",
      "idxInFile" : 0,
      "idxInPage" : 4,
      "codeBlockLength" : 4,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "win" : "1",
      "code" : "<canvas id=\"canvas\" width=\"300\", height=\"300\"><\/canvas>"
    },
    {
      "id" : "coffee",
      "lang" : "coffee",
      "filename" : "main.coffee",
      "fileNoExt" : "main",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "#!end",
      "idxInFile" : 0,
      "idxInPage" : 5,
      "codeBlockLength" : 110,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "win" : "1",
      "code" : "#!vanilla\nplotFunction = ->\n    canvasId = \"canvas\"\n    f = identity\n    xMax = 2\n    new ComplexFunctionImage {canvasId, f, xMax}, colorMap\n\ncolorMap =\n    saturation: (r) -> 1\n    lightness: (r) -> 0.5 * (1 - 1 \/ (1 + 25*log10(2*r + 1)))\n    opacity: (r) -> 1 \/ (1 + 4*log10(1+2*r))    \n\ncomplex = numeric.complex\nlog10 = (x) -> Math.log(x)\/Math.LN10\n\nidentity = (z) -> z\n\n# Comment vanilla directive to use these functions (overloaded ops).\nsquare = (z) -> z*z\n\ncube = (z) -> z*z*z\n\nclass ComplexFunctionImage\n\n    constructor: (@spec, @colorMap) ->\n        # spec:\n        #   canvasId\n        #   pixelsPerSquare\n        #   f (complex function)\n        #   xMin, xMax, yMin, yMax\n        # colorMap:\n        #   saturation, lightness, opacity (functions of r)\n        \n        # Canvas\n        @pixelsPerSquare = @spec.pixelsPerSquare ? 2\n        @image = new Image @spec.canvasId, @pixelsPerSquare\n        @pxMax = @image.xMax()\n        @pyMax = @image.yMax()\n\n        # Complex function\n        @f = @spec.f\n        @xMax = @spec.xMax\n        @xMin = @spec.xMin ? -@xMax\n        @yMax = @spec.yMax ? @xMax\n        @yMin = @spec.yMin ? -@yMax\n        \n        # Domain scaling\n        @kx = (@xMax - @xMin)\/(@pxMax-1)\n        @ky = (@yMax - @yMin)\/(@pyMax-1)\n        \n        @plot()\n        \n    plot: ->\n        for px in [0..@pxMax-1]\n            x = @kx*px + @xMin\n            for py in [0..@pyMax-1]\n                y = -(@ky*py + @yMin)\n                z = complex x, y\n                zf = @f z\n                v = zf.abs().x\n                hsla =\n                    h: @angle zf\n                    s: @colorMap.saturation v\n                    l: @colorMap.lightness v\n                    a: @colorMap.opacity v\n                @image.setSquareHsla px, py, hsla\n        \n    angle: (z) ->\n        # Angle (degrees)\n        pi = Math.PI\n        a = Math.atan2(z.y, z.x)  # -pi to pi\n        a += 2*pi if a<0  # 0 to 2pi\n        360\/(2*pi)*a\n        \nclass Image\n\n    constructor: (@canvasId, @pixelsPerSquare=1) ->\n        @element = document.getElementById @canvasId\n        @width = @element.width\n        @height = @element.height\n        @element.width = @width  # Clears canvas\n        @ctx = @element.getContext \"2d\"\n        \n    setSquare: (x, y, col=\"red\") ->\n        p = @pixelsPerSquare\n        @ctx.fillStyle = col\n        @ctx.fillRect p*x, p*y, p, p\n        \n    setSquareHsla: (x, y, hsla) ->\n        col = \n            \"hsla(#{hsla.h}, \"+\n            \"#{100*hsla.s}%, \"+\n            \"#{100*hsla.l}%, \"+\n            \"#{hsla.a})\"\n        @setSquare x, y, col\n        \n    setSquareFromMap: (x, y, hue, map, r, m=1) ->\n        sat = 1\n        light = map.lightness r, m\n        opacity = map.opacity r, m\n        @setSquareHsla x, y, {h: hue, s: sat, l: light, a: opacity}        \n        \n    xMax: -> @width\/@pixelsPerSquare\n    yMax: -> @height\/@pixelsPerSquare\n\n$blab.ComplexFunctionImage = ComplexFunctionImage\n#plotFunction()"
    },
    {
      "id" : "result",
      "lang" : "coffee",
      "filename" : "result.coffee",
      "fileNoExt" : "result",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "#!end",
      "idxInFile" : 0,
      "idxInPage" : 6,
      "codeBlockLength" : 4,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "code" : ""
    },
    {
      "id" : "js",
      "lang" : "javascript",
      "filename" : "main.js",
      "fileNoExt" : "main",
      "isExec" : false,
      "isScript" : false,
      "endToken" : "\/\/!end",
      "idxInFile" : 0,
      "idxInPage" : 7,
      "codeBlockLength" : 4,
      "codeBlockStart" : 0,
      "show" : "1",
      "out" : "1",
      "code" : ""
    }
  ]
}